use kernel::common::cells::VolatileCell;

pub const MCE_PATCH: Patches = Patches::new();

#[repr(C)]
pub struct MCERam {
    mce_ram: [VolatileCell<u32>; 484],
}

#[derive(Copy, Clone)]
pub struct Patches {
    mce_patch: *const MCERam,
}

impl Patches {
    pub const fn new() -> Patches {
        Patches {
            mce_patch: 0x21008000 as *const MCERam,
        }
    }

    pub fn apply_patch(&self) {
        let p_mce_patch = unsafe { &*self.mce_patch };
        let mut i = 0;
        for reg in p_mce_patch.mce_ram.iter() {
            reg.set(PATCH_GENFSK_MCE[i]);
            i += 1;
        }
    }
}

static PATCH_GENFSK_MCE: [u32; 484] = [
    0x2fcf603c, 0x030c3f9d, 0x070c680a, 0xfff0003f, 0xff0000ff, 0x00c08080, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00070003, 0x00003d1f, 0x04000000, 0x0000000f, 0x000b0387, 0x004340f4,
    0x00828000, 0x06700080, 0x091e0000, 0x00540510, 0x02000005, 0x00613e10, 0x002f0000, 0x027f3030,
    0x00000000, 0x00000000, 0x00000000, 0x0000aa00, 0x00000000, 0x00000000, 0x72637223, 0xa4e5a35d,
    0x73057303, 0x73047203, 0x72047306, 0x72917391, 0xffc0b008, 0xa0089010, 0x720e720d, 0x7210720f,
    0x7100b0d0, 0xa0d0b110, 0x8162721b, 0x39521020, 0x00200670, 0x11011630, 0x6c011401, 0x60796078,
    0x637960f8, 0x60786078, 0x60786078, 0x60796078, 0x637960f8, 0x60786078, 0x60786078, 0x72231210,
    0x73127311, 0x81b17313, 0x91b00010, 0x6050b070, 0xc030606e, 0xc14167c1, 0xc4e0c2b2, 0x6f131820,
    0x16116e23, 0x687f1612, 0x9c807830, 0x9c907840, 0x9ca07850, 0x948078a0, 0xc4f29490, 0x1820c750,
    0x12034095, 0x16126e23, 0x78b06892, 0x606e9990, 0x81907291, 0x81709640, 0x2a703980, 0x16111001,
    0x84b484a2, 0xc0f5c0f3, 0x1c01c200, 0xc10040bd, 0x40b31c10, 0x10134cb5, 0x18301803, 0x1a101a13,
    0x68b03912, 0x13f360bd, 0x13f360bd, 0xc1001015, 0x1a151850, 0x39141a10, 0xb0e868bb, 0xb1287100,
    0xb230a0e8, 0x8990b910, 0xb1119930, 0x7100b0d1, 0xb012b002, 0xa0d1b111, 0xb6307291, 0xb013b003,
    0xb0e0722c, 0xb1207100, 0x92c08170, 0xb1207100, 0x22f08170, 0x13f044d6, 0x40e21c03, 0x964292c3,
    0xb1207100, 0x964492c5, 0xb1207100, 0xa630b0e0, 0xa0e17000, 0x9910c030, 0x9930c040, 0xb0d1b111,
    0xb1117100, 0x7291a0d1, 0xa002a003, 0x7000a230, 0x73127311, 0x67c1c040, 0x91f0c100, 0xb6336498,
    0xb0d3b113, 0xa0d37100, 0x606e64e9, 0xb016b006, 0xb014b004, 0xb012b002, 0x78628440, 0x81730420,
    0x2a733983, 0xc1f294e3, 0x31621832, 0x31511021, 0x00200012, 0x10309440, 0x10011610, 0x39303121,
    0x41232210, 0x31501220, 0x31801003, 0x16300010, 0x12029380, 0x22731204, 0x84a04136, 0x89829970,
    0x84c01a82, 0x89849970, 0x61381a84, 0x41432263, 0x997084b0, 0x1a808980, 0x84d01402, 0x89809970,
    0x14041a80, 0x84b0614f, 0x04107891, 0x89829970, 0x84d01a42, 0x04107891, 0x89849970, 0x31521a44,
    0x39633154, 0x16130633, 0x38343832, 0x39823182, 0x00423184, 0x84a09722, 0x84b09590, 0x84c095a0,
    0x84d095b0, 0x781095c0, 0x90509030, 0x90407820, 0xb2359060, 0x83338cb2, 0xb0199332, 0xc00cb018,
    0x8170c00b, 0x39803180, 0x81713940, 0x0431c0f3, 0x1441c014, 0x1412c002, 0x3122697b, 0xc01084ed,
    0x312d140d, 0x8c9e142d, 0x311e318e, 0x8c99397e, 0x39793149, 0x31293949, 0x81a0109a, 0x41922200,
    0xb008b009, 0x720e720d, 0xb121720f, 0x7100b0e1, 0xa0e1b072, 0xb06ea04e, 0xb06cb011, 0x993ab089,
    0xb9147291, 0xc662a914, 0xc04f9912, 0x8c8166fa, 0x45ae22f1, 0x22f18ca1, 0x625845ae, 0xb0737100,
    0x80b7b910, 0x45e52207, 0x8c81a910, 0x41bf22f1, 0x41bf2237, 0x80b0b133, 0x45ba2230, 0x22e161cd,
    0x809041d2, 0x41d22250, 0x8240b115, 0x41ae2220, 0xb9149939, 0xb116a914, 0x993d61ae, 0xa914b914,
    0x61aeb116, 0x22f08ca0, 0x223741de, 0xb07541de, 0x80b0b133, 0x45d82230, 0x61aeb087, 0x433d22d1,
    0x22208090, 0x66c0433d, 0x993f61ae, 0x8450c7f3, 0x39803180, 0x00303183, 0xb0879450, 0xb112a0f3,
    0xb115a0d2, 0xb111a0d5, 0xa0d6b0d1, 0xb133b130, 0x220080b0, 0x223045f6, 0x710045f6, 0x99301260,
    0xba3fb111, 0x87208b11, 0x97011801, 0x8c418c30, 0xa009a008, 0xa637a638, 0x1801c022, 0x4e181c21,
    0x4a161412, 0x1c016219, 0x4e184219, 0x6219b637, 0xb041b638, 0x8ca0b061, 0x422122e0, 0x22208240,
    0x7100458d, 0xb06eb04e, 0x220180b1, 0x223146b2, 0x729146b2, 0x84e1b116, 0xc2603121, 0x99301410,
    0x9910c7e0, 0x9910c6f0, 0xb0d6b116, 0xb960a0d1, 0x8c448c33, 0x8c648c53, 0x80b17100, 0x46b22201,
    0x46b22231, 0x22c08c80, 0x8b414648, 0x418d2201, 0xc00081f1, 0x84e091f0, 0x6a4c81d2, 0xc30091f1,
    0xb2319070, 0x67c1c050, 0xa0f3a0f0, 0x7000a044, 0xb0737100, 0x80b7b910, 0x46772207, 0x46952237,
    0x8c81a910, 0x427022e1, 0x22508090, 0xb1154270, 0x22208240, 0x993d4258, 0xa914b914, 0x6258b116,
    0x433d22d1, 0x22208090, 0x66c0433d, 0x993f6258, 0xa0d2b112, 0xa0d5b115, 0xb0d1b111, 0xb130a0d6,
    0x80b0b133, 0x467f2200, 0x467f2230, 0x12607100, 0xb1119930, 0x8b11ba3f, 0x31808720, 0x18013d80,
    0x8c309701, 0xa1b28c41, 0x993f6208, 0xa0d2b112, 0xa0d5b115, 0xb0d1b111, 0xb130a0d6, 0x80b0b133,
    0x469d2200, 0x469d2230, 0x12607100, 0xb1119930, 0x8b11ba3f, 0x3d808720, 0x97011801, 0x8c618c50,
    0x6208b1b2, 0xa910b073, 0xa960b910, 0xa04eb072, 0xb011b06e, 0x22f08c80, 0x220145e5, 0x62954677,
    0x22b08c80, 0x1e3b46c6, 0x62c846f8, 0x46f81e7b, 0xba39c00b, 0x31808af0, 0x16103d80, 0x140c3d30,
    0x220080b0, 0x700042d4, 0x39838c83, 0x8c8106f3, 0x0401cff0, 0x1c1c3031, 0x12004ef0, 0x1c0c1810,
    0x80b04af2, 0x42e52200, 0x10c27000, 0x3c321612, 0x83508cb1, 0x42f42210, 0x933162f6, 0x7000b112,
    0x62e1101c, 0x62e1100c, 0x62ed1821, 0x62ed1421, 0x62ee161b, 0xb111b116, 0xb133b130, 0xb112b115,
    0x720e720d, 0xb0f0720f, 0x8c82b0f3, 0x430b22f2, 0xb913b0d6, 0x8ca0630e, 0x432e22f0, 0xa444b445,
    0xa469b468, 0x3180caa0, 0x0001caa1, 0x94d194c1, 0x31838ca3, 0x84503983, 0x39803180, 0x00303183,
    0x84409450, 0x39503150, 0x39838ca3, 0xc1f406f3, 0x31841834, 0x00403134, 0xb0899440, 0x433822e2,
    0x394a8c9a, 0x312a398a, 0xb0d5993a, 0xb913b0d6, 0x22d28c82, 0xb0d2433c, 0xb23f7000, 0xa0f3a0f0,
    0xb914993e, 0xb116a914, 0xb133b130, 0x22f08240, 0xb1154346, 0xa0048002, 0xa001a006, 0x72047203,
    0x67c1c060, 0xb9147100, 0xb0d5b116, 0x7100a23f, 0xa0d5b115, 0x90307810, 0x78209002, 0x90609040,
    0xa23fb072, 0x993a66fa, 0xb116a914, 0xba3c61a7, 0x8b5481b0, 0x31843924, 0x91b40004, 0x67c1c070,
    0x72917391, 0x72067263, 0x72047202, 0x73067305, 0x8240606e, 0x47812230, 0x7100b0d5, 0xa0d5b115,
    0x13006379, 0xb63c91e0, 0xc080b35d, 0xb11867c1, 0x12006506, 0x99301a10, 0x9910c380, 0x9910c280,
    0xb0d6a0d1, 0x22008090, 0x81844450, 0x43921e04, 0xb1169934, 0xd0908702, 0x67c19a12, 0x22118b41,
    0x8c5243a8, 0xe0a08c63, 0x9a239a12, 0x63ae67c1, 0x8c438c32, 0x9a12e0b0, 0x67c19a23, 0x89318940,
    0x4bbe1c01, 0x1ef11801, 0x89314bbc, 0x99311af1, 0xb1167100, 0x993116f1, 0x7100a235, 0xa0d6b116,
    0x9a006367, 0x220089f0, 0xb9e047c2, 0x00007000,
];
